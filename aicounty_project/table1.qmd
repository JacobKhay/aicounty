---
title: "Replication of Table 1"
format: html  # or html if you want browser output
execute:
  echo: false
  warning: false
  message: false
---

```{r setup}
library(tidyverse)
library(fixest)
library(modelsummary)

# Read and preprocess data
data_ai <- read_csv("data.csv") %>%
  ungroup() %>%
  mutate(
    degshare = (udeg + mdeg) / Employed,
    stemshare = (ustemdeg + mstemdeg) / (udeg + mdeg),
    stemshare2 = ustemdeg / udeg,
    stemshare = replace_na(stemshare, 0),
    stemshare2 = replace_na(stemshare2, 0),
    tightness = nads / Unemployed,
    hpi_ch = hpi_ch / 100,
    logpop = log(pop),
    logincome = log(medhhincome),
    pat_intensity = n_inventors / Employed,
    patai_intensity = ai_patents / n_patents,
    large_firms = 1 - (small + medium) / est,
    information_intensity = information_emp / emp,
    manuf_intensity = manuf_emp / emp,
    ai_intensity = ai / nads,
    lads = log(1 + nads),
    state_year = paste0(state, Year)
  )

data_ai_z <- data_ai %>%
  filter(emp != 0) %>%
  mutate(
    share_bac = scale(share_bac),
    share_black = scale(share_black),
    share_poverty = scale(share_poverty),
    logpop = scale(logpop),
    hpi_ch = scale(hpi_ch),
    logincome = scale(logincome),
    tightness = scale(tightness),
    unrate = scale(unrate),
    pat_intensity = scale(pat_intensity),
    patai_intensity = scale(patai_intensity),
    degshare = scale(degshare),
    stemshare = scale(stemshare),
    large_firms = scale(large_firms),
    information_intensity = scale(information_intensity),
    manuf_intensity = scale(manuf_intensity),
    TurnOvrS = scale(TurnOvrS),
    ai_intensity = ai_intensity * 100
  )
# Run regressions for each column of Table 1
est_demog_no = feols(ai_intensity ~ share_bac + share_black + share_poverty + logpop + hpi_ch + logincome + tightness | Year + COUNTY_FIPS, data = data_ai_z, cluster = "COUNTY_FIPS", weights = ~lads)

est_innovation_no = feols(ai_intensity ~ pat_intensity + patai_intensity + degshare + stemshare | Year + COUNTY_FIPS, data = data_ai_z, cluster = "COUNTY_FIPS", weights = ~lads)

est_industry_no = feols(ai_intensity ~ large_firms + information_intensity + manuf_intensity + TurnOvrS | Year + COUNTY_FIPS, data = data_ai_z, cluster = "COUNTY_FIPS", weights = ~lads)

est_all = feols(ai_intensity ~ share_bac + share_black + share_poverty + logpop + hpi_ch + logincome + tightness +
  pat_intensity + patai_intensity + degshare + stemshare + large_firms +
  information_intensity + manuf_intensity + TurnOvrS | Year + COUNTY_FIPS,
  data = data_ai_z, cluster = "COUNTY_FIPS", weights = ~lads)

est_all_large = feols(ai_intensity ~ share_bac + share_black + share_poverty + logpop + hpi_ch + logincome + tightness +
  pat_intensity + patai_intensity + degshare + stemshare + large_firms +
  information_intensity + manuf_intensity + TurnOvrS | state_year + COUNTY_FIPS,
  data = data_ai_z, cluster = "COUNTY_FIPS", weights = ~lads)
# Define clean variable labels
labels <- c(
  "share_bac" = "Bachelors’ share, z-score",
  "share_black" = "Black pop, z-score",
  "share_poverty" = "Poverty share, z-score",
  "logpop" = "log(Population), z-score",
  "hpi_ch" = "House Price Growth, z-score",
  "logincome" = "log(Median Income), z-score",
  "tightness" = "Labor Market Tightness, z-score",
  "pat_intensity" = "Patents per employee, z-score",
  "patai_intensity" = "AI patents’ share, z-score",
  "degshare" = "Degrees awarded per capita, z-score",
  "stemshare" = "Stem Degrees’ share, z-score",
  "large_firms" = "Large Establishments, z-score",
  "information_intensity" = "ICT sector Intensity, z-score",
  "manuf_intensity" = "Manufacturing Intensity, z-score",
  "TurnOvrS" = "Turnover Rate, z-score"
)

# Render formatted table
modelsummary(
  list(
    "(1)" = est_demog_no,
    "(2)" = est_innovation_no,
    "(3)" = est_industry_no,
    "(4)" = est_all,
    "(5)" = est_all_large
  ),
  coef_map = labels,
  stars = TRUE,
  gof_omit = "IC|Log|Adj|RMSE",
  statistic = "({std.error})",
  output = "kableExtra",
  title = "Table 1: The Correlates of the Share of Artificial Intelligence Jobs"
)
```
